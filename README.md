# 10_Hybrid_Recommender_Systems

# 10.3 Основы A/B-тестирования
## А/В-тестирование
В этом материале мы обсудим А/В-тестирование и правильный процесс проведения А/В-теста, или А/В-эксперимента.

Возможно, вы слышали, как в бытовом разговоре говорят что-то вроде: «А давайте протестируем гипотезу». Обычно под этим подразумевают расплывчатый и предельно общий набор понятий.

Здесь и кроется важный момент. Если мы говорим о проверке гипотезы с помощью правильно проведённого А/В-теста, это подразумевает ряд тонкостей, каждая из которых имеет строгое обоснование.

Почему важно соблюдать все тонкости? Потому что в рамках исследований нас всегда сопровождает вероятность сделать неправильный вывод, найти какой-либо эффект там, где его на самом деле нет, и принять неверное решение, которое потом принесёт проекту убытки. Это может произойти по разным причинам: плохо спланировали эксперимент, не собрали достаточно данных и так далее. Правильно проведённый А/В-тест позволяет свести эффект принятия неправильного решения к разумному минимуму.

Таким образом, А/В-тест — это исследование с чёткой структурой, которое проводится на основе разделения пользователей на несколько групп и сравнения разницы их поведения. Минимальное количество групп — две, но возможны случаи с бо́льшим количеством вариантов.

При проведении теста необходимо понимать:

какую метрику мы будем проверять;
какую разницу хотим увидеть между группами;
сколько пользователей будет в каждой из групп;
какой статистический критерий мы будем использовать.
В рамках А/В-теста одна из групп называется контрольной (alpha). Это группа, к которой мы не применяем никаких новых воздействий. Например, пользователи, попавшие в эту группу, работают на текущей версии алгоритма, видят текущую версию рекламы и так далее. Остальные группы, для которых тестируются какие-либо изменения, называются тестовыми (beta).

Метрика и размер эффекта
Что необходимо учитывать при проведении А/В-тестирования:

До начала теста нужно проверить, что всё настроено правильно и пользователи каждой из групп взаимодействуют с элементами, которые вы планируете протестировать. Например, в случае рекомендательных систем необходимо проверить, что для контрольной и тестовой групп работают соответствующие алгоритмы.
Следующий важный пункт — выбор метрики, по которой будет оцениваться успешность эксперимента. Это должна быть важная для проекта бизнес-метрика, на которую вы непосредственно воздействуете в рамках теста. Популярные метрики: конверсия в действие, размер среднего чека покупателя или среднее время пользователя на проекте.
Кроме основной метрики выбирают так называемые защитные метрики (guardrail). Это особо важные метрики продукта, которые не должны пострадать во время теста. Например, общая прибыль проекта в каждой из групп.
Необходимо предположить размер эффекта, то есть какое изменение метрики ожидается получить в ходе эксперимента. Размер эффекта зависит от того, какие изменения внедряются. Если это небольшие итеративные улучшения предыдущей системы, не стоит ожидать серьёзных изменений. Эффект можно измерять как абсолютно (конверсия в действие была 3%, а стала 4%), так и относительно (конверсия выросла на 30%).
Теперь у нас есть метрика, по которой будет оцениваться эксперимент, и мы предполагаем, насколько она может измениться. Осталось понять, насколько уверенно можно говорить о том, что метрика действительно поменялась.

Проверка гипотез
В этом нам поможет метод проверки статистических гипотез. Для использования метода необходимо иметь несколько сущностей:

собранные в ходе эксперимента данные, их также называют выборкой;
нулевую гипотезу — H0;
альтернативную гипотезу — H1;
статистику, подсчитанную на основе выборки;
уровень значимости и мощность;
статистический критерий.
Разберёмся с этими понятиями.



Гипотеза
Гипотеза — это утверждение, которое мы будем проверять в рамках теста.

В эксперименте всегда есть нулевая гипотеза (H0), которая предполагает, что никаких различий между группами нет — старая и новая версии системы работают одинаково.

Альтернативная гипотеза (H1) говорит, что изменения в группах всё-таки есть. А это значит, что новая система работает хуже или лучше старой.



Статистика
Статистика — это функция, числовой результат которой можно подсчитать на основе собранных данных. Особенность статистики заключается в том, что мы заранее знаем её распределение, в случае если нулевая гипотеза верна. И, следовательно, можем сделать вывод о результате, который получили в рамках текущего теста. Такое распределение называется нулевым.



Уровень значимости и мощность
Уровень значимости α — это вероятность отклонить гипотезу Н0, если она верна, то есть найти отличие там, где его фактически нет.

Мощность — это вероятность отвергнуть неверную нулевую гипотезу, найти эффект там, где он действительно есть.

Определив предполагаемый эффект изменения в целевой метрике, уровень значимости и мощность, можно подсчитать, сколько пользователей должно быть в каждой из групп, чтобы сделать какие-то выводы об изменении метрики. В этом способен помочь калькулятор расчёта эффекта, например Sample Size Calculator.

Для примера возьмём уровень значимости 5% (0,05), мощность — 80% (0,8), базовый уровень метрики — 3%, ожидаемый относительный рост — 33% и получим, что необходимо как минимум по 4 800 пользователей в каждой из групп.
